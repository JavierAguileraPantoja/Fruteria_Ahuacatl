<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ticket por producto</title>

  <style>
    body {
      font-family: "Courier New", monospace;
      font-size: 12px;
    }

    .ticket {
      width: 310px; /* 80mm */
      margin: 0 auto;
    }

    .center { text-align: center; }
    .bold { font-weight: bold; }
    .line { border-top: 1px dashed #000; margin: 5px 0; }
    .sm { font-size: 10px; }

    @media print {
      body { margin: 0; }
      .no-print { display: none; }
    }
  </style>
</head>
<body>

<div class="ticket">

  <div class="center">
    <img src="/Uploads/logo.png" style="width:120px; margin-bottom:5px;">
    <div class="bold">FRUTERÍA AHUACATL</div>
    <div class="bold">VENTAS POR PRODUCTO</div>
    <div class="sm">Resumen de kilos vendidos</div>
  </div>

  <div class="line"></div>

  <%
    const fecha = fechaCorte || new Date();
    const fechaStr = fecha.toLocaleDateString('es-MX', {
      year: 'numeric', month: '2-digit', day: '2-digit'
    });
    const horaStr = fecha.toLocaleTimeString('es-MX', {
      hour: '2-digit', minute: '2-digit'
    });
  %>

  <div>
    Fecha: <%= fechaStr %><br>
    Hora:  <%= horaStr %><br>
    Usuario: <%= user && user.name ? user.name : 'ADMIN' %><br>
  </div>

  <div class="line"></div>

  <div class="bold">Productos:</div>

  <% if (productos && productos.length > 0) { %>
    <% productos.forEach(p => { %>
      <div>
        <%= p.producto %><br>
        Vendido: <%= p.unidades.toFixed(3) %> kg  
        ($ <%= p.totalVenta.toFixed(2) %>)<br>
        ------------------
      </div>
    <% }) %>
  <% } else { %>
    <div>No hay ventas en el periodo.</div>
  <% } %>

  <div class="line"></div>

  <div class="center sm">
    Ahuacatl — Control por producto
  </div>

</div>

<div class="center no-print" style="margin-top: 10px;">
  <button onclick="window.print()">Imprimir</button>
</div>

</body>
</html>
